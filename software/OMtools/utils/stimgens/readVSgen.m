% Written by:  Jonathan Jacobs%              last mod:  12/03/16)%% *** pict files need to be in the same directory as the stim file.%% Line formats:% xpos ypos dur 'circ' diameter color  % xpos ypos dur 'pict' wid hgt angle filename% xpos ypos dur 'text' size color  text_stringfunction  target = readVSgen(vsgenfile)fid = fopen(vsgenfile);in_text = fread(fid);in_text = char(in_text)';fclose(fid);count = 0;isEOF = 0;target = cell(1,100);while( ~isEOF )   % read in the next non-empty line   emptyLine = 1;   while( emptyLine )       [topline, in_text, emptyLine, isEOF] = getnextl(in_text);      if isEOF,return,end    %disp('EOF reached')   end   count=count+1;   tgt_line = proclinec(topline);      % put values into appropriate structure for stim type   tgt_type = tgt_line{4};   target{count}.x    = str2double(tgt_line{1});   target{count}.y    = str2double(tgt_line{2});      % duration will be limited to multiples of 50 msec (20 Hz)   % if EB computer is fast enough, could switch to 20 ms, 50 Hz.   temp = str2double(tgt_line{3});   fiftysafe = fix( temp / 0.05 ) * 0.05;   if fiftysafe ~= temp      disp([ num2str(temp) ' sec rounded to nearest 50 msec: ' num2str(fiftysafe)]);   end   target{count}.dur = fiftysafe;       target{count}.type = tgt_type;   switch tgt_type           case 'circ'           if length(tgt_line) >4              target{count}.dia   = str2double(tgt_line{5});              target{count}.color = tgt_line{6};           end       case 'pict'           target{count}.wid   = str2double(tgt_line{5});           target{count}.hgt   = str2double(tgt_line{6});           target{count}.angle = str2double(tgt_line{7});           target{count}.fname = tgt_line{8};           % load picture           [target{count}.pdata, target{count}.cmap] = imread(tgt_line{8});       case 'text'           target{count}.hgt   = str2double(tgt_line{5});           target{count}.color = tgt_line{6};           target{count}.angle = str2double(tgt_line{7});           target{count}.text  = tgt_line{8};             end %switch      % lose the empty cells   target = target(1:count);     end % while ~isEOF