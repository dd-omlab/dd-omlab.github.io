% OMpath.m: add the directories needed to use OMtools% Usage: ompath(action)% where action is either 'set' or 'clear' (Default is 'set')% Written by:  Jonathan Jacobs%              December 1995 - October 2020  (last mod: 14 Oct 2020)%% 21 March 2003: added '/' as sep character for MATLAB 6.5 (OS X, yay!)% 24 March 2003: added sep2 for UNIX (ML6.5 on OS X)% 20 June 2009:  added 'overrides' directory.  loads BEFORE standard ML toolboxes%    Mar 2017: Gutted and modernized%    Oct 2020: Added 'set' and 'clear' functionality% 20 Jul 2021: Open 'pathtool' so you can see if paths were added.function ompath(action)%if nargin==0,action='clear';end  %%%%%% debug lineif nargin==0, action='set'; end   % real lineif any(strcmpi(action,{'clear','remove'}))   oldpath = path;   newpath = oldpath;   stops  = strfind(oldpath,{':'});   starts = [1 stops(1:end-1)+1];   d = [];   for ii=1:length(stops)      dirname = oldpath(starts(ii):stops(ii));      b = any(strfind(lower(dirname),'omtools'));      c = any(strfind(lower(dirname),'simstuff'));      if b || c         d(end+1) = ii; %#ok<*AGROW>         % delete this path entry         seg{ii} = starts(ii):stops(ii);         newpath(seg{ii}) = char(444);         %rmpath(dirname)      end   end   ee = strfind(newpath,char(444));   if isempty(ee)      disp('OMtools was not found on the MATLAB path.')   else      newpath(ee)='';      path(newpath)      savepath      disp('OMtools paths have been cleared from the MATLAB path.')      disp('You can re-add them by running "ompath" from within its directory.')   end   returnendfs = filesep;ps = pathsep;curdir = pwd;omtoolspath = char(findomtools);cd(omtoolspath)modelspath = [];if exist([omtoolspath [fs 'simstuff']],'dir')   modelspath = omtoolspath;else   cd ..   if exist([pwd [fs 'simstuff']],'dir')      modelspath = pwd;   endend% check if omtools appears on matlabpathP = path;mlp  = lower(P);nomt = strfind(mlp,[fs 'omtools']);otd  = strfind(mlp,[fs 'omtoolsdirs']); % do not count this double!try    nomt(nomt==otd)=[];catch, end% As of 2 Mar 2021, there are 13 OMtools folders (including subfolders)% that appear on the MATLAB path. (See below.)if length(nomt) >= 13 %% && isempty(modelspath)   fprintf('OMtools is on the MATLAB path. ')   fprintf('Type ompath(''clear'') if you wish to remove it.\n')   cd(curdir)   returnend%[pn, ~, ~] = fileparts(mfilename('fullpath'));cd(pn)ompath('clear')P = path;mlp  = lower(P);nomt = strfind(mlp,[fs 'omtools']);otd  = strfind(mlp,[fs 'omtoolsdirs']); % do not count this double!try    nomt(nomt==otd)=[];catch, endif nomt >= 1   disp('I could not delete all OMtools entries from the MATLAB path.')   disp('You will have to remove them manually. Type "pathtool" and delete')   disp('any lines containing "OMtools".')   return   enddisp('I will try to add the OMtools directories to the MATLAB path.')% Add 'overrides' to appear BEFORE any MATLAB built-in functions.% If using R2012a or later, we can ignore Overrides, since ML defaults % to using proper java windows.temp = ver('MATLAB');ML_VER = str2double(temp.Version);if (ML_VER > 7.13) && (ML_VER <= 8.1)   over_dir = [omtoolspath fs 'overrides'];   if exist(over_dir,'dir')      mlp = path([omtoolspath fs 'overrides' ps], mlp); %#ok<NASGU>   endend% 13 core directories should ALWAYS be presentcd(omtoolspath)add = '';add = [add omtoolspath ps];if exist('omprefs','dir')   add = [add omtoolspath fs 'omprefs' ps]; endadd = [add omtoolspath fs 'rd' ps];add = [add omtoolspath fs 'rd' fs 'pickdata' ps];add = [add omtoolspath fs 'utils' ps];add = [add omtoolspath fs 'utils' fs 'filt' ps];add = [add omtoolspath fs 'utils' fs 'stimgens' ps];add = [add omtoolspath fs 'analysis' ps];add = [add omtoolspath fs 'analysis' fs 'tplot3' ps];add = [add omtoolspath fs 'labels' ps];add = [add omtoolspath fs 'omtoolsdirs' ps];add = [add omtoolspath fs 'graphing' ps];add = [add omtoolspath fs 'zoomtool' ps];add = [add omtoolspath fs 'eyeballs3d' ps];% Simulink model might not be present in some installationsif ~isempty(modelspath)   add = [add modelspath fs 'simstuff' ps];   add = [add modelspath fs 'simstuff' fs 'misc' ps];   add = [add modelspath fs 'simstuff' fs 'diagrams' ps];   add = [add modelspath fs 'simstuff' fs 'common' ps];   add = [add modelspath fs 'simstuff' fs 'LNsim' ps];   add = [add modelspath fs 'simstuff' fs 'LNsim' fs 'mfiles' ps];   add = [add modelspath fs 'simstuff' fs 'CNsim' ps];   add = [add modelspath fs 'simstuff' fs 'CNsim' fs 'mfiles' ps];   add = [add modelspath fs 'simstuff' fs 'SPsim' ps];   add = [add modelspath fs 'simstuff' fs 'SPsim' fs 'mfiles' ps];   add = [add modelspath fs 'simstuff' fs 'SaccSim' ps];   add = [add modelspath fs 'simstuff' fs 'SaccSim' fs 'mfiles' ps];endtry    cd(curdir)catch, end% Were they added?pathtoolpath(add,P);P = path;mlp  = lower(P);nomt = strfind(mlp,[fs 'omtools']);otd  = strfind(mlp,[fs 'omtoolsdirs']); % do not count this double!try    nomt(nomt==otd)=[];catch, endif nomt < 13   disp('Hmmm. Make sure the OMtools folder exists in your local MATLAB directory,')   disp('that you have read/write access, and try running "ompath" again.')   returnenddisp(' ')disp('Success! The OMtools paths should appear at the top.')disp('Click the "Save" button if you want OMtools available whenever you launch MATLAB.')disp('It will remain available until you remove it by typing "ompath(''clear'')", or')disp('by manually deleting each "OMtools" directory with "pathtool".')disp('Click the "Revert" button to remove it now.')disp('If you later wish to re-add OMtools, run "ompath" directly from within its directory.')end %function ompath